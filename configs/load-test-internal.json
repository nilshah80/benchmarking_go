{
  "$schema": "https://benchmarking-go/schema/v1.json",
  "name": "Identity Service - Internal Client Load Test",
  "description": "Load test for internal client endpoints using Basic Auth (dev-client and wildcard internal-service)",
  "baseUrl": "http://localhost:8140",

  "settings": {
    "concurrentUsers": 50,
    "duration": "60s",
    "rateLimit": 500,
    "timeout": "10s",
    "rampUp": "10s",
    "http2": false,
    "insecure": false,
    "disableKeepAlive": false,
    "percentiles": [50, 90, 95, 99],
    "showHistogram": true,
    "showLiveStats": true
  },

  "variables": {
    "baseUrl": "http://localhost:8140",
    "devClientAuth": "Basic ZGV2LWNsaWVudDpkZXYtc2VjcmV0LWNoYW5nZS1pbi1wcm9kdWN0aW9u",
    "wildcardClientAuth": "Basic aW50ZXJuYWwtc2VydmljZTppbnRlcm5hbC1zZXJ2aWNlLXNlY3JldC0yMDI0"
  },

  "defaultHeaders": {
    "Accept": "application/json"
  },

  "requests": [
    {
      "name": "Health Check",
      "url": "{{baseUrl}}/health",
      "method": "GET",
      "weight": 5
    },
    {
      "name": "Readiness Check",
      "url": "{{baseUrl}}/ready",
      "method": "GET",
      "weight": 5
    },
    {
      "name": "Token Issue - Dev Client (Minimal)",
      "url": "{{baseUrl}}/v1/token/issue",
      "method": "POST",
      "weight": 25,
      "headers": {
        "Content-Type": "application/json",
        "Authorization": "{{devClientAuth}}"
      },
      "body": {
        "audience": "orders-api",
        "scope": "orders.read"
      }
    },
    {
      "name": "Token Issue - Dev Client (With Subject)",
      "url": "{{baseUrl}}/v1/token/issue",
      "method": "POST",
      "weight": 20,
      "headers": {
        "Content-Type": "application/json",
        "Authorization": "{{devClientAuth}}"
      },
      "body": {
        "audience": "orders-api",
        "scope": "orders.read orders.write",
        "subject": "load-test-user",
        "include_refresh_token": true
      }
    },
    {
      "name": "Token Issue - Dev Client (Custom Claims)",
      "url": "{{baseUrl}}/v1/token/issue",
      "method": "POST",
      "weight": 15,
      "headers": {
        "Content-Type": "application/json",
        "Authorization": "{{devClientAuth}}"
      },
      "body": {
        "audience": "orders-api",
        "scope": "orders.read",
        "subject": "load-test-user",
        "custom_claims": {
          "roles": "admin",
          "tenant": "test-corp"
        }
      }
    },
    {
      "name": "Token Issue - Wildcard Client (Any Audience)",
      "url": "{{baseUrl}}/v1/token/issue",
      "method": "POST",
      "weight": 15,
      "headers": {
        "Content-Type": "application/json",
        "Authorization": "{{wildcardClientAuth}}"
      },
      "body": {
        "audience": "payment-gateway-api",
        "scope": "payments.process payments.refund",
        "subject": "wildcard-test-user",
        "custom_claims": {
          "merchantId": "MERCH-001",
          "tier": "premium"
        }
      }
    },
    {
      "name": "Token Issue - Array Audience",
      "url": "{{baseUrl}}/v1/token/issue",
      "method": "POST",
      "weight": 10,
      "headers": {
        "Content-Type": "application/json",
        "Authorization": "{{devClientAuth}}"
      },
      "body": {
        "audience": ["orders-api", "inventory-api"],
        "scope": "orders.read",
        "subject": "multi-aud-user"
      }
    },
    {
      "name": "Token Issue - Custom TTL",
      "url": "{{baseUrl}}/v1/token/issue",
      "method": "POST",
      "weight": 5,
      "headers": {
        "Content-Type": "application/json",
        "Authorization": "{{devClientAuth}}"
      },
      "body": {
        "audience": "orders-api",
        "scope": "orders.read",
        "ttl": 300
      }
    }
  ],

  "output": {
    "format": "text",
    "file": "load-test-results.json"
  },

  "thresholds": {
    "maxErrorRate": 0.01,
    "maxAvgLatency": "200ms",
    "maxP90Latency": "500ms",
    "maxP99Latency": "1s",
    "minRequestsPerSecond": 100
  }
}
